[Full script.js from above, shortened here for space]